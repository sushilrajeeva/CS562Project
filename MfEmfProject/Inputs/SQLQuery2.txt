//Find for each customer the sum of sales in “NY”, the sum of sales in “CT” and the sum of sales in “NJ”, if New York's average is less than 2 times average of "NJ" and less than "CT".


CREATE VIEW MFQ2_View1 AS
	SELECT PROD, CUST, SUM(QUANT) as SUM, SUM(QUANT)/COUNT(QUANT) AS Avg
	FROM SALES
	WHERE STATE='NY'
	GROUP BY PROD,CUST
	
SELECT * FROM MFQ2_View1

CREATE VIEW MFQ2_View2 AS
	SELECT PROD, CUST, SUM(QUANT) as SUM, SUM(QUANT)/COUNT(QUANT) AS Avg
	FROM SALES
	WHERE STATE='NJ'
	GROUP BY PROD,CUST
	
SELECT * FROM MFQ2_View2

CREATE VIEW MFQ2_View3 AS
	SELECT PROD, CUST, SUM(QUANT) as SUM, SUM(QUANT)/COUNT(QUANT) AS Avg
	FROM SALES
	WHERE STATE='CT'
	GROUP BY PROD,CUST
	
SELECT * FROM MFQ2_View3

SELECT V1.PROD, V1.CUST, V1.SUM, V2.SUM, V3.SUM, V1.AVG, V2.AVG, V3.AVG
FROM MFQ2_View1 as V1, MFQ2_View2 AS V2, MFQ2_View3 AS V3
WHERE V1.PROD = V2.PROD AND V1.PROD = V3.PROD AND V1.CUST = V2.CUST AND V1.CUST = V3.CUST AND V1.AVG<2*V2.AVG AND V1.AVG<V3.AVG
	
